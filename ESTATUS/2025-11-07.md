# ESTATUS - 2025-11-07

## Resumen
- Iniciamos la Opcion B (multi-tenant real) en la app.
- Agregado selector/creador de empresa para superAdmin, persistencia de `tenantId` y deteccion automatica de tenant por membership.
- Migradas referencias restantes a rutas `tenants/{tenantId}/...` y verificacion de rol por `members/{uid}`.
- Build de produccion OK.

## Cambios tecnicos
- `src/App.jsx`
  - Migrada eliminacion de activos a `tenants/{tenantId}/assets`.
  - Importados `collectionGroup` y `documentId` para consultar membresias del usuario.
  - Estado multi-tenant: `tenantId`, `tenants`, `newTenantId` y persistencia en `localStorage`.
  - Carga de lista de `tenants` para superAdmin y creacion rapida de tenant (`tenants/{newTenantId}`).
  - Resolucion automatica de `tenantId` para usuarios normales buscando `tenants/*/members/{uid}`.
  - Header muestra `Empresa: <tenantId>` y agrega selector para superAdmin.

## Requisitos backend (pendientes)
- Reglas Firestore multi-tenant (ver borrador en `ESTATUS/REGLAS_FIRESTORE.md`).
- Indices: `inspections` por `date desc` dentro de cada tenant.
- Colecciones minimas por tenant: `members`, `assets`, `inspections`.

## QA rapido
- Flujo: login con Google -> (superAdmin) seleccionar/crear tenant -> crear activo -> generar inspeccion -> ver dashboard/historial.
- `npm run build` completado sin errores.

## Proximos pasos propuestos
1) Reglas de seguridad multi-tenant y despliegue.
2) Mensaje UI cuando no hay `tenantId` (usuario normal sin membership) solicitando contacto con admin.
3) (Opcional) Renombrar check de `admins/{uid}` a `superAdmins/{uid}` para alinear con docs.
4) Script de migracion desde `artifacts/{appId}` si hubiera datos previos.

